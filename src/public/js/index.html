<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>wgscovplot</title>
  <style>
    #nav-tabContent {
      padding-top: 56px;
    }

    /*Freeze Table Header*/
    #summary-coverage-stat thead tr th {
      position: sticky;
      top: 56px;
      background: #cccccc;
    }

    /* following CSS rules for btn-toggle are from sidebars.css from https://getbootstrap.com/docs/5.0/examples/sidebars/# */
    .btn-toggle {
      display: inline-flex;
      align-items: center;
      padding: .25rem .5rem;
      font-weight: 600;
      color: rgba(0, 0, 0, .65);
      background-color: transparent;
      border: 0;
    }

    .btn-toggle:hover,
    .btn-toggle:focus {
      color: rgba(0, 0, 0, .85);
      background-color: #d2f4ea;
    }

    .btn-toggle::before {
      width: 1.25em;
      line-height: 0;
      content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%280,0,0,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
      transition: transform .35s ease;
      transform-origin: .5em 50%;
    }

    .btn-toggle[aria-expanded="true"] {
      color: rgba(0, 0, 0, .85);
    }

    .btn-toggle[aria-expanded="true"]::before {
      transform: rotate(90deg);
    }

    .btn-sidebar-hider {
      display: inline-flex;
      align-items: center;
      height: 100%;
      padding: .1rem .1rem;
      font-weight: 600;
      color: rgba(0, 0, 0, .65);
      background-color: transparent;
      border: 0;
    }

    .btn-sidebar-hider:hover,
    .btn-sidebar-hider:focus {
      color: rgba(0, 0, 0, .85);
      background-color: #b8b8b8;
    }

    .btn-sidebar-hider::before {
      width: 1.0em;
      line-height: 5;
      content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%280,0,0,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
      transition: transform .35s ease;
      transform-origin: .5em 50%;
    }

    .btn-sidebar-hider[aria-expanded="true"] {
      color: rgba(0, 0, 0, .85);
    }

    .btn-sidebar-hider[aria-expanded="true"]::before {
      transform: rotateY(180deg);
    }

    .info-icon {
      cursor: help;
    }
  </style>
<script defer src="wgscovplot.dev.bundle.js"></script></head>
<body>
<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">
      WGSCOVPLOT
    </span>
    <div class="navbar-nav nav me-auto mb-2 mb-lg-0">
      <a type="button"
         class="nav-link active"
         aria-current="page"
         data-bs-toggle="tab"
         data-bs-target="#chart-pane"
         aria-selected="true">
        Coverage Plot
      </a>
      <a type="button"
         class="nav-link show-for-unsegmented-viruses"
         aria-current="page"
         data-bs-toggle="tab"
         data-bs-target="#varmap-chart-pane"
         aria-selected="true">
        Variant Heatmap
      </a>
      <a type="button"
         class="nav-link"
         data-bs-toggle="tab"
         data-bs-target="#summary-table"
         aria-selected="false">
        Summary Information
      </a>
      <a type="button"
         class="nav-link"
         data-bs-toggle="tab"
         data-bs-target="#about"
         aria-selected="false">
        About
      </a>
    </div>
  </div>
</nav>

<div id="nav-tabContent"
     class="tab-content" >
  <div id="chart-pane"
       class="tab-pane show active"
       role="tabpanel">
    <div class="d-inline-flex">
      <div id="control-menu"
           class="col-2 collapse show small bg-light border">
        <!--- Select Samples ---->
        <div class="row mb-1 p-1">
          <div class="d-flex">
            <h6>Samples</h6>
            <span class="info-icon text-info ms-1"
                  title="Select samples to show in coverage plot">ℹ️</span>
          </div>
          <select id="selected-samples" multiple="multiple"></select>
        </div>
        <!--- Select Segments ---->
        <div class="row mb-1 p-1 show-for-segmented-viruses">
          <div class="d-flex">
            <h6>Segments</h6>
            <span class="info-icon text-info ms-1" title="Select segments to show in coverage plot">ℹ️</span>
          </div>
          <select id="selected-segments" multiple="multiple"></select>
        </div>
        <!--- Axis Options ---->
        <div class="border rounded mb-1">
          <button class="btn btn-toggle rounded collapsed" data-bs-toggle="collapse"
                  data-bs-target="#axis-options" aria-expanded="false">
            Axis Options
          </button>
          <div class="collapse p-1" id="axis-options">
            <div class="row">
              <label for="select-y-scale"
                     class="col-sm-4 col-form-label">
                Y-axis Scale
              </label>
              <div class="col-sm-7">
                <select id="select-y-scale" class="form-select form-select-sm">
                  <option value="value">Linear</option>
                  <option value="log" selected>Log</option>
                </select>
              </div>
            </div>
            <div class="row">
              <label for="ymax"
                     class="col-sm-4 col-form-label">
                Y-axis Limit
              </label>
              <div class="col-sm-7">
                <div class="input-group">
                  <input id="ymax"
                         class="form-control form-control-sm"
                         type="number"
                         value=1000>
                  <button id="btn-set-ymax"
                          class="btn btn-sm btn-primary"
                          type="button">
                    Set
                  </button>
                </div>
              </div>
            </div>
            <div class="row mb-0">
              <div>
                <div class="form-check form-switch">
                  <label class="form-check-label"
                         for="toggle-xaxis-label">
                    Show X-axis Label
                  </label>
                  <input id="toggle-xaxis-label"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--- Tooltips ---->
        <div class="border rounded mb-1">
          <button class="btn btn-toggle rounded collapsed"
                  data-bs-toggle="collapse"
                  data-bs-target="#tooltips"
                  aria-expanded="false">
            Tooltips
          </button>
          <div class="collapse p-1" id="tooltips">
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-tooltip"
                         class="form-check-label">
                    Show Tooltips
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Select samples to show in coverage plot">ℹ️</span>
                  <input id="toggle-tooltip"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="fix-tooltip-position"
                         class="form-check-label">
                    Show tooltips in fixed position
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Show tooltips in fixed positions rather than wherever the mouse cursor was">ℹ️</span>
                  <input id="fix-tooltip-position"
                         class="form-check-input"
                         type="checkbox">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-show-tooltip-on-click"
                         class="form-check-label">
                    Show on tooltips click
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Only show tooltips on mouse click rather than when hovering over coverage plots">ℹ️</span>
                  <input id="toggle-show-tooltip-on-click"
                         class="form-check-input"
                         type="checkbox">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-tooltip-variant-sites"
                         class="form-check-label">
                    Focus tooltips on variant sites
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Focus tooltips on variant sites">ℹ️</span>
                  <input id="toggle-tooltip-variant-sites"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-tooltip-non-variant-sites"
                         class="form-check-label">
                    Show tooltips for non-variant sites
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Show tooltips for non-variant sites">ℹ️</span>
                  <input id="toggle-tooltip-non-variant-sites"
                         class="form-check-input"
                         type="checkbox">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-tooltip-sample-comparison"
                         class="form-check-label">
                    Compare info across samples
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="In tooltips, show variant and/or coverage stats comparison tables for all samples shown in coverage plots">ℹ️</span>
                  <input id="toggle-tooltip-sample-comparison"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-tooltip-cov-stats"
                         class="form-check-label">
                    Show coverage statistics
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Show coverage statistics in tooltip">ℹ️</span>
                  <input id="toggle-tooltip-cov-stats"
                         class="form-check-input"
                         type="checkbox">
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--- Display Options ---->
        <div class="border rounded mb-1">
          <button class="btn btn-toggle rounded collapsed" data-bs-toggle="collapse"
                  data-bs-target="#display-options" aria-expanded="false">
            Display Options
          </button>
          <div class="collapse p-1" id="display-options">
            <div class="row mb-1 show-for-unsegmented-viruses">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-slider"
                         class="form-check-label">
                    Show view region Slider
                  </label>
                  <input id="toggle-slider"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            <div class="row mb-3 show-for-unsegmented-viruses">
              <div class="">
                <div class="input-group">
                  <input id="start-pos"
                         class="form-control form-control-sm"
                         type="number"
                         value=1>
                  <input id="end-pos"
                         class="form-control form-control-sm"
                         type="number"
                         value=100>
                  <button id="btn-show-region"
                          class="btn btn-sm btn-outline-primary">
                    Show region
                  </button>
                </div>
              </div>
            </div>
            <div class="row mb-3 show-for-unsegmented-viruses">
              <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                <button id="btn-reset-view"
                        class="btn btn-sm btn-outline-secondary">
                  Reset view
                </button>
              </div>
            </div>
            <div class="row mb-4">
              <label for="ymax"
                     class="col-sm-7 col-form-label">
                Low coverage Threshold
              </label>
              <div class="col-sm-5">
                <div class="input-group">
                  <input id="low-threshold"
                         class="form-control form-control-sm"
                         type="number"
                         value=10
                         style="width: 30%">
                  <button id="btn-set-low-threshold"
                          class="btn btn-sm btn-primary"
                          type="button">
                    Set
                  </button>
                </div>
              </div>
            </div>
            <div class="row mb-4">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-low-coverage-regions"
                         class="form-check-label">
                    Highlight low coverage regions
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Highlight low coverage regions">ℹ️</span>
                  <input id="toggle-low-coverage-regions"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="d-flex">
                  <label for="chart-height-input"
                         class="form-label">
                    Subplot Height
                  </label>
                  <output id="chart-height-output"
                          class="text-muted ms-auto">0</output>
                  <span class="text-muted">%</span>
                </div>
                <div>
                  <input id="chart-height-input"
                         class="form-range"
                         type="range"
                         value="0.0" min="1.0" max="100.0" step="0.1">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="d-flex">
                  <label for="chart-left-input"
                         class="form-label">
                    Left Margin
                  </label>
                  <output id="chart-left-output"
                          class="text-muted ms-auto">0</output>
                  <span class="text-muted">%</span>
                </div>
                <div>
                  <input id="chart-left-input"
                         class="form-range"
                         type="range"
                         value="0.0" min="0.0" max="25.0" step="0.1">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="d-flex">
                  <label for="chart-right-input"
                         class="form-label">
                    Right Margin
                  </label>
                  <output id="chart-right-output"
                          class="text-muted ms-auto">0</output>
                  <span class="text-muted">%</span>
                </div>
                <div>
                  <input id="chart-right-input"
                         class="form-range"
                         type="range"
                         value="4.0" min="0.0" max="25.0" step="0.1">
                </div>
              </div>
            </div>
            <div class="row mb-1">
              <div>
                <div class="d-flex">
                  <label for="chart-top-input"
                         class="form-label">
                    Subplot Top Margin
                  </label>
                  <output id="chart-top-output"
                          class="text-muted ms-auto">0</output>
                  <span class="text-muted">%</span>
                </div>
                <div>
                  <input id="chart-top-input"
                         class="form-range"
                         type="range"
                         value="6.5" min="0.0" max="25.0" step="0.1">
                </div>
              </div>
            </div>
            <div class="row mb-4">
              <div class="col-md">
                <button id="btn-reset-margins"
                        class="btn btn-sm btn-outline-primary">
                  Reset plot margins and heights
                </button>
              </div>
            </div>
            <div class="d-flex">
              <div class="">
                <label for="render-env"
                       class="col-form-label">
                  Renderer
                </label>
                <span class="info-icon text-info ms-1"
                      title="Canvas for high performance and export PNG file &#10;SVG for high quality image (SVG file) but slightly lower performance">ℹ️</span>
              </div>
              <div class="me-auto">
                <select id="render-env"
                        class="form-select form-select-sm">
                  <option value="svg">SVG (vector graphics)</option>
                  <option value="canvas" selected>Canvas (raster, e.g. PNG)</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-darkmode"
                         class="form-check-label">
                    Dark Mode
                  </label>
                  <input id="toggle-darkmode"
                         class="form-check-input"
                         type="checkbox">
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--- Genetic Feature Options ---->
        {% if gene_feature == true or amplicon == true %}
        <div class="border rounded mb-1 show-for-unsegmented-viruses">
          <button class="btn btn-toggle rounded collapsed" data-bs-toggle="collapse"
                  data-bs-target="#gene-features" aria-expanded="false">Genetic Features
          </button>
          <div class="collapse p-1" id="gene-features">
            <div class="row">
              <div class="d-flex">
                <label for="genefeature-height-input"
                       class="form-label">
                  Feature Plot Height
                </label>
                <output class="text-muted ms-auto"
                        id="genefeature-height-output">15.0</output><span class="text-muted">%</span>
              </div>
              <div>
                <input id="genefeature-height-input"
                       class="form-range"
                       type="range"
                       value="15.0" min="1.0" max="50.0" step="0.1">
              </div>
            </div>
            {% if gene_feature == true %}
            <div class="row mb-1">
              <div>
                <div class="form-check form-switch">
                  <label for="toggle-gene-label"
                         class="form-check-label">
                    Show gene labels
                  </label>
                  <span class="info-icon text-info ms-1"
                        title="Show Gene Features Names">ℹ️</span>
                  <input id="toggle-gene-label"
                         class="form-check-input"
                         type="checkbox"
                         checked>
                </div>
              </div>
            </div>
            {% endif %}
            {% if amplicon == True %}
            <div class="form-check form-switch">
              <label class="form-check-label" for="toggle-amplicon">Show Amplicon</label>
              <span class="info-icon text-info ms-1"
                    title="Show Amplicon Features and Coverage Bars">ℹ️</span>
              <input class="form-check-input" type="checkbox" id="toggle-amplicon" checked>
            </div>
            {% endif %}
            <div class="row mb-1">
              <div class="form-group">
                <label for="select2-features">Select Features</label>
                <span class="info-icon text-info ms-1"
                      title="Select interest features and click Apply button for viewing">ℹ️</span>
                <select id="select2-features" class="form-select form-select-sm"
                        multiple="multiple">
                </select>
                <button id="btn-show-selected-features" class="btn btn-sm btn-outline-primary">Apply</button>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
        <!--- Variant Calls ---->
        <div class="border rounded mb-1">
          <button class="btn btn-toggle rounded collapsed" data-bs-toggle="collapse"
                  data-bs-target="#variant-calls" aria-expanded="false">
            Variant Calls
          </button>
          <div class="collapse p-1" id="variant-calls">
            <div>
              <div class="form-check form-switch">
                <label for="toggle-show-variant-labels"
                       class="form-check-label">
                  Show variant labels
                </label>
                <span class="info-icon text-info ms-1"
                      title="Show variant labels below subplot x-axes">ℹ️</span>
                <input id="toggle-show-variant-labels"
                       class="form-check-input"
                       type="checkbox">
              </div>
            </div>
            <div>
              <div class="form-check form-switch">
                <label for="toggle-hide-overlapping-variant-labels"
                       class="form-check-label">
                  Hide Overlapping Variant Labels
                </label>
                <span class="info-icon text-info ms-1"
                      title="Hide/Show overlapping mutation display">ℹ️</span>
                <input id="toggle-hide-overlapping-variant-labels"
                       class="form-check-input"
                       type="checkbox"
                       checked>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="align-items-stretch bg-light border">
        <button class="btn btn-sm btn-sidebar-hider"
                id="control-menu-hider"
                data-bs-toggle="collapse"
                data-bs-target="#control-menu"
                title="Hide/Show Options Sidebar"
                aria-expanded="true"
        ></button>
      </div>
      <div id="chart-container" class="flex-grow-1">
        <div id="chart"></div>
      </div>
    </div>
  </div>
  <div class="tab-pane" id="varmap-chart-pane" role="tabpanel">
    <div class="container-fluid" id="varmap-chart"></div>
  </div>
  <div class="tab-pane" id="about" role="tabpanel">
    <div class="container">
      {{ about_html }}
    </div>
  </div>
  <div class="tab-pane" id="summary-table" role="tabpanel">
    <div class="container-fluid">
      {{ summary_info }}
    </div>
  </div>
</div>
<script type="text/javascript" src="./js/wgscovplot.dev.bundle.js"></script>
<script type="text/javascript" src="./js/sars-cov-2-db.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    const $chart = document.getElementById("chart");
    const $variantHeatmap = document.getElementById("varmap-chart");
    console.debug(wgscovplot);
    console.time("convert base64 depths");
    let xs;
    for (let [sample, depthsBase64] of Object.entries(db.depths)) {
      xs = Array.from(new Uint16Array(new Uint8Array([...atob(depthsBase64)].map(c => c.charCodeAt(0))).buffer));
      for (let i = 0; i < xs.length; i++) {
        if (xs[i] === 0) {
          xs[i] = 0.0000001;
        }
      }
      db.depths[sample] = xs;
    }
    console.timeEnd("convert base64 depths");
    db.chart = wgscovplot.echarts.init($chart, "white", {renderer: "canvas"});
    db.variantHeatmap = wgscovplot.echarts.init($variantHeatmap, "white", {renderer: "canvas"});
    db.positions = [...Array(db.ref_seq.length + 1).keys()];
    db.selectedSamples = db.samples.slice(0, 3);
    db.showVariantSiteTooltips = true;
    db.showNonVariantSiteTooltips = false;
    db.showVariantLabels = false;
    db.hideOverlappingVariantLabels = false;
    db.showGeneLabels = true;
    db.padTop = 4.0;
    db.heightOffset = 6.0;
    db.leftMargin = "4.0%";
    db.rightMargin = "4.0%";

    db.showCovStatsInTooltips = true;
    db.crossSampleComparisonInTooltips = true;
    db.yMax = 1000;
    db.showLowCovRegions = true;
    db.showLowCovRegionsOpacity = 0.5;
    db.scaleType = "log"

    db.tooltipEnabled = true;
    db.tooltipTriggerOn = "mousemove";
    db.fixedTooltipPosition = false;


    function updateChartDivSize() {
      let BOTTOM_PADDING = 20;
      let bbox = $chart.getBoundingClientRect();
      let top = bbox.top;
      let height = window.innerHeight - top - BOTTOM_PADDING;
      if (height < 300) {
        height = 300;
      }
      $chart.style.height = height + "px";
      $chart.style.width = (window.innerWidth - bbox.left) + "px";
      db.chart.resize();
      $variantHeatmap.style.height = height + "px";
      $variantHeatmap.style.width = window.innerWidth + "px";
      db.variantHeatmap.resize();
    }
    updateChartDivSize();
    setTimeout(updateChartDivSize, 1000);
    window.addEventListener("resize", updateChartDivSize);

    document.getElementById("control-menu-hider").addEventListener("transitionend", function (event) {
      updateChartDivSize();
    });
    document.getElementById("control-menu").addEventListener("transitionend", function (event) {
      updateChartDivSize();
    });

    /**
     * @typedef {Elements}
     */
    let elements = {
      $chart,
      $variantHeatmap,
      $chartHeightInput: document.getElementById("chart-height-input"),
      $chartHeightOutput: document.getElementById("chart-height-output"),
      $chartTopInput: document.getElementById("chart-top-input"),
      $chartTopOutput: document.getElementById("chart-top-output"),
      $chartLeftInput: document.getElementById("chart-left-input"),
      $chartLeftOutput: document.getElementById("chart-left-output"),
      $chartRightInput: document.getElementById("chart-right-input"),
      $chartRightOutput: document.getElementById("chart-right-output"),
      $genefeatureHeightInput: document.getElementById("genefeature-height-input"),
      $genefeatureHeightOutput: document.getElementById("genefeature-height-output"),
      $renderEnv: document.getElementById("render-env"),
      $selectedSamples: $("#selected-samples"),
      $selectedGeneFeatures: $("#selected-gene-feature-name"),
      $toggleDarkMode: document.getElementById("toggle-darkmode"),
      $toggleGeneLabel: document.getElementById("toggle-gene-label"),
      $toggleAmplicons: document.getElementById("toggle-amplicon"),
      $toggleShowVariantLabels: document.getElementById("toggle-show-variant-labels"),
      $startPos: document.getElementById("start-pos"),
      $endPos: document.getElementById("end-pos"),
      $btnShowRegion: document.getElementById("btn-show-region"),
      $ymax: document.getElementById("ymax"),
      $btnSetYMax: document.getElementById("btn-set-ymax"),
      $selectYScale: document.getElementById("select-y-scale"),
      $lowThreshold: document.getElementById("low-threshold"),
      $btnSetLowCovThreshold: document.getElementById("btn-set-low-threshold"),
      $toggleTooltip: document.getElementById("toggle-tooltip"),
      $toggleShowAmplicon: document.getElementById("toggle-amplicon"),
      $toggleHideOverlappingVariantLabels: document.getElementById("toggle-hide-overlapping-variant-labels"),
      $toggleXAxisLabel: document.getElementById("toggle-xaxis-label"),
      $toggleShowVariantSiteTooltips: document.getElementById("toggle-tooltip-variant-sites"),
      $toggleShowNonVariantSiteTooltips: document.getElementById("toggle-tooltip-non-variant-sites"),
      $toggleShowLowCovRegions: document.getElementById("toggle-low-coverage-regions"),
      $toggleFixedTooltipPosition: document.getElementById("fix-tooltip-position"),
      $btnShowSelectedFeatures: document.getElementById("btn-show-selected-features"),
      $toggleTooltipCovStats: document.getElementById("toggle-tooltip-cov-stats"),
      $toggleShowTooltipOnClick: document.getElementById("toggle-show-tooltip-on-click"),
      $toggleTooltipVariantComparison: document.getElementById("toggle-tooltip-sample-comparison"),
      $toggleDataZoomSlider: document.getElementById("toggle-slider"),
      $btnResetView: document.getElementById("btn-reset-view"),
      $btnResetMargins: document.getElementById("btn-reset-margins"),
    }
    window.elements = elements;

    const selectedSamplesOpts = [];
    for (let i = 0; i < db.samples.length; i++) {
      let sample = db.samples[i];
      selectedSamplesOpts.push({
        id: i,
        text: sample,
        selected: db.selectedSamples.includes(sample),
      });
    }
    elements.$selectedSamples.select2({
      data: selectedSamplesOpts,
      tags: true,
    });
    // hide UI elements if segmented or non-segmented virus
    const isNonSegmented = (db.segments === undefined || db.segments === null);
    if (isNonSegmented) {
      $(".show-for-segmented-viruses").hide();
    } else {
      $(".show-for-unsegmented-viruses").hide();
    }
    wgscovplot.initWgscovplotRenderEnv({ db, elements });
    wgscovplot.initEventHandlers({ db, elements });
  });
</script>
</body>
</html>